<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#" onclick="loadPage('admin-dashboard.html')">Reports</a></li>
        <li class="breadcrumb-item active" aria-current="page">Instructor-wise Course List</li>
    </ol>
</nav>

<h2 class="mb-3">Instructor-wise Course List</h2>

<div class="mb-3">
    <input type="text" id="instructorSearchInput" class="form-control form-control mb-3"
        placeholder="Search by Instructor Name..." />
</div>

<div class="table-responsive">
    <table class="table table-bordered align-middle">
        <thead class="table-light">
            <tr>
                <th>Instructor ID</th>
                <th>Instructor Name</th>

                <th>Expertise</th>
                <th>Courses Assigned</th>
            </tr>
        </thead>
        <tbody id="instructorCourseTableBody">
            <!-- Data dynamically populated here -->
        </tbody>
    </table>
</div>

<script>
    (() => {

        let allInstructors = [];
        let allCourses = [];
        let sortDirection = 1;
        const apiUrl = "http://localhost:8080/api";
        const tbody = document.getElementById("instructorCourseTableBody");
        const searchInput = document.getElementById("instructorSearchInput");

        //Searching---------------------------------------------------------------------------
        searchInput.addEventListener("input", () => {
            const keyword = searchInput.value.toLowerCase();
            const filtered = allInstructors.filter(instr =>
                instr.name.toLowerCase().includes(keyword) ||
                instr.expertise.toLowerCase().includes(keyword)
            );
            renderInstructorCourse(filtered);
        });

        //Sorting---------------------------------------------------------------------------------
        document.querySelector("th:nth-child(2)").style.cursor = "pointer";
        document.querySelector("th:nth-child(2)").addEventListener("click", () => {
            const sorted = [...allInstructors].sort((a, b) =>
                a.name.localeCompare(b.name) * sortDirection
            );
            sortDirection *= -1;
            renderInstructorCourse(sorted);
        });

        document.querySelector("th:nth-child(3)").style.cursor = "pointer";
        document.querySelector("th:nth-child(3)").addEventListener("click", () => {
            const sorted = [...allInstructors].sort((a, b) =>
                a.expertise.localeCompare(b.expertise) * sortDirection
            );
            sortDirection *= -1;
            renderInstructorCourse(sorted);
        });


        //Fetch Instructor & Course---------------------------------------------------------------------------------

        function fetchInstructorCourse() {
            Promise.all([
                fetch(`${apiUrl}/instructors`).then(res => res.json()),
                fetch(`${apiUrl}/courses`).then(res => res.json())
            ])
                .then(([instructorData, courseData]) => {
                    allInstructors = instructorData;
                    allCourses = courseData;
                    renderInstructorCourse(allInstructors);
                })
                .catch(err => console.error("Error loading data:", err));
        }

        //Display Instructor & Course-----------------------------------------------------
        function renderInstructorCourse(data) {
            tbody.innerHTML = "";
            data.forEach(instructor => {
                const assignedCourses = allCourses
                    .filter(course => course.instructorid == instructor.id)
                    .map(course => `<li>${course.title}</li>`)
                    .join("") || "<li>No Courses</li>";

                const row = `
                    <tr>
                        <td>${instructor.id}</td>
                        <td>${instructor.name}</td>
                        <td>${instructor.expertise || 'N/A'}</td>
                        <td><ul class="mb-0 ps-3">${assignedCourses}</ul></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        fetchInstructorCourse();
    })();
    //END----------------------------------------------------------
</script>