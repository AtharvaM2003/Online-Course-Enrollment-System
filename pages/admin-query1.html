<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="#" onclick="loadPage('admin-admin-query1.html')">Queries</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Courses by Students</li>
    </ol>
</nav>

<div class="container mt-4">
    <div class="form-group">
        <label for="studentDropdown">Select Student:</label>
        <select class="form-control" id="studentDropdown" onchange="fetchEnrollments()">
            <option value="">-- Select Student --</option>
        </select>
    </div>

    <h4 class="mt-4">Courses Enrolled:</h4>
    <ul id="courseList" class="list-group"></ul>
</div>

<script>(() => {
        let allUsers = [];
        let allEnrollments = [];
        let allCourses = [];
        const userUrl = 'http://localhost:8080/api/users';
        const EnrollmentsUrl = 'http://localhost:8080/api/enrollments';
        const CoursesUrl = 'http://localhost:8080/api/courses';
        const dropdown = document.getElementById('studentDropdown');

        //Fetch User, Enrollments, Courses------------------------------------------
        function fetchData() {
            Promise.all([
                fetch(userUrl).then(res => res.json()),
                fetch(EnrollmentsUrl).then(res => res.json()),
                fetch(CoursesUrl).then(res => res.json())
            ])
                .then(([usersData, enrollmentsData, coursesData]) => {
                    allUsers = usersData;
                    allEnrollments = enrollmentsData;
                    allCourses = coursesData;

                    renderDropdown();
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        //Display User, Enrollments, Courses in Select------------------------------------------
        function renderDropdown() {
            allUsers.forEach(user => {
                if (user.usertype.toLowerCase() === 'student') {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = user.name;
                    dropdown.appendChild(option);
                }
            });
            dropdown.addEventListener('change', fetchEnrollments);
        }

        //Display Enrolled Courses of Student----------------------------------------
        function fetchEnrollments() {
            const selectedUserId = document.getElementById('studentDropdown').value;
            const courseList = document.getElementById('courseList');
            courseList.innerHTML = '';

            if (selectedUserId) {
                const enrolledCourses = allEnrollments.filter(enrollment => enrollment.userid == selectedUserId);

                if (enrolledCourses.length > 0) {
                    enrolledCourses.forEach(enrollment => {
                        const course = allCourses.find(c => c.id == enrollment.courseid);
                        if (course) {
                            const li = document.createElement('li');
                            li.className = 'list-group-item';
                            li.textContent = `${course.title} - ${course.description}`;
                            courseList.appendChild(li);
                        }
                    });
                } else {
                    const li = document.createElement('li');
                    li.className = 'list-group-item';
                    li.textContent = 'No courses enrolled.';
                    courseList.appendChild(li);
                }
            }
        }

        fetchData();
    })();

    //END--------------------------------------------------------

</script>