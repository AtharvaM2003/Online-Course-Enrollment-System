<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#" onclick="loadPage('student-dashboard.html')">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Enrolled Courses</li>
    </ol>
</nav>

<h2 class="mb-3">Enrolled Courses</h2>
<p>Browse your enrolled courses.</p>

<div class="row" id="enrolledCourseList"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (() => {
        const apiUrl = "http://localhost:8080/api";
        const allEnrolledCourses = document.getElementById('enrolledCourseList');

        let allInstructors = [];
        let allCourses = [];

        function getUserId() {
            return sessionStorage.getItem("userId");
        }

        //Fetch Enrollements, Courses, Instructors--------------------------------------------
        function fetchEnrolledCourses() {
            Promise.all([
                fetch(`${apiUrl}/instructors`).then(res => res.json()),
                fetch(`${apiUrl}/courses`).then(res => res.json()),
                fetch(`${apiUrl}/enrollments/user/${getUserId()}`).then(res => res.json())
            ])
                .then(([instructorData, courseData, enrollmentData]) => {
                    allInstructors = instructorData;
                    allCourses = courseData;

                    const enrolledCourses = enrollmentData.map(enroll => {
                        const course = allCourses.find(c => c.id === enroll.courseid);
                        const instructor = allInstructors.find(i => i.id === (course ? course.instructorid : null));
                        return {
                            title: course ? course.title : "N/A",
                            description: course ? course.description : "N/A",
                            fees: course ? course.fees : "N/A",
                            courseId: course ? (course.courseid || course.id) : "N/A",
                            instructorName: instructor ? instructor.name : "N/A",
                            enrolledOn: enroll.enrollmentdate
                        };
                    });

                    renderEnrolledCourses(enrolledCourses);
                })
                .catch(error => {
                    console.error('Error loading enrolled courses:', error);
                });
        }

        //Display Enrolled Courses----------------------------------------------------
        function renderEnrolledCourses(courses) {
            allEnrolledCourses.innerHTML = "";
            courses.forEach(course => {
                const card = document.createElement('div');
                card.className = "col-md-4 mb-4 course-card";
                card.setAttribute('data-price', course.fees);
                card.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">${course.title}</h5>
                        <p class="mb-1"><strong>Instructor:</strong> ${course.instructorName}</p>
                        <p class="mb-1"><strong>Enrolled On:</strong> ${formatDate(course.enrolledOn)}</p>
                        <p class="mb-2"><strong>Price:</strong> â‚¹${course.fees}</p>
                    </div>
                </div>
            `;
                allEnrolledCourses.appendChild(card);
            });
        }
        //Date for show in Card--------------------------------------------
        function formatDate(dateStr) {
            const options = { day: '2-digit', month: 'short', year: 'numeric' };
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-GB', options).replace(/ /g, '-');
        }

        fetchEnrolledCourses();
    })();
    //END-------------------------------------------------------------
</script>