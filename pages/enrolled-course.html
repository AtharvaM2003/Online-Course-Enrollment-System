<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="#" onclick="loadPage('student-dashboard.html')">Dashboard</a></li>
        <li class="breadcrumb-item active" aria-current="page">Enrolled Courses</li>
    </ol>
</nav>

<h2 class="mb-3">Enrolled Courses</h2>
<p>Browse your enrolled courses.</p>

<div class="row" id="enrolledCourseList"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    (() => {
        const apiBaseUrl = "http://localhost:3000";
        const enrolledCourseList = document.getElementById('enrolledCourseList');

        let instructorList = [];
        let allCourseList = [];

        function getUserId() {
            return sessionStorage.getItem("userId");
        }

        async function loadEnrolledCourses() {
            try {
                const [instructorRes, courseRes, enrollmentRes] = await Promise.all([
                    fetch(`${apiBaseUrl}/Instructors`),
                    fetch(`${apiBaseUrl}/Courses`),
                    fetch(`${apiBaseUrl}/Enrollments?userid=${getUserId()}`)
                ]);

                instructorList = await instructorRes.json();
                allCourseList = await courseRes.json();
                const enrollments = await enrollmentRes.json();

                const enrolledCourses = enrollments.map(enroll => {
                    const course = allCourseList.find(c => c.id === enroll.courseid);
                    const instructor = instructorList.find(i => i.id === course.instructorid);
                    return {
                        title: course.title,
                        description: course.description,
                        duration: course.duration || "N/A",
                        fees: course.fees,
                        courseId: course.courseid || course.id,
                        instructorName: instructor ? instructor.name : "N/A",
                        enrolledOn: enroll.enrollmentdate
                    };
                });

                renderEnrolledCourses(enrolledCourses);

            } catch (error) {
                console.error('Error loading enrolled courses:', error);
            }
        }

        function renderEnrolledCourses(courses) {
            enrolledCourseList.innerHTML = "";
            courses.forEach(course => {
                const card = document.createElement('div');
                card.className = "col-md-4 mb-4 course-card";
                card.setAttribute('data-price', course.fees);
                card.innerHTML = `
                <div class="card h-100 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">${course.title}</h5>
                        <p class="mb-1"><strong>Instructor:</strong> ${course.instructorName}</p>
                        <p class="mb-1"><strong>Enrolled On:</strong> ${formatDate(course.enrolledOn)}</p>
                        <p class="mb-2"><strong>Price:</strong> â‚¹${course.fees}</p>
                    </div>
                </div>
            `;
                enrolledCourseList.appendChild(card);
            });
        }

        function formatDate(dateStr) {
            const options = { day: '2-digit', month: 'short', year: 'numeric' };
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-GB', options).replace(/ /g, '-');
        }

        loadEnrolledCourses();
    })();
</script>